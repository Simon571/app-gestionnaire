(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3673],{6447:(e,r,t)=>{"use strict";t.d(r,{A:()=>o});var s=t(95155),a=t(12115),n=t(3998),l=t(92033),i=t(58772),d=t(15894),c=t(10960);function o(e){let{type:r,getPayload:t,save:o,disabled:u,label:m}=e,{toast:f}=(0,d.dj)(),[p,h]=a.useState(!1),x=async()=>{if(!u){h(!0);try{o&&await o();let e=t?t():{};if(!(await (0,c.e)("/api/publisher-app/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:r,payload:e,notify:!0})})).ok)throw Error("Impossible de cr\xe9er le job de synchronisation");f({title:"Enregistr\xe9 et envoy\xe9",description:"Le job a bien \xe9t\xe9 cr\xe9\xe9 pour Publisher App."})}catch(e){console.error("link-to-publisher error",e),f({title:"Erreur",description:(null==e?void 0:e.message)||"Envoi impossible",variant:"destructive"})}finally{h(!1)}}};return(0,s.jsxs)(n.Button,{onClick:x,disabled:u||p,className:"bg-sky-600 hover:bg-sky-700 text-white",children:[p?(0,s.jsx)(l.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(i.A,{className:"mr-2 h-4 w-4"}),null!=m?m:"Enregistrer & Envoyer vers Publisher App"]})}},55633:(e,r,t)=>{Promise.resolve().then(t.bind(t,95938))},73457:(e,r,t)=>{"use strict";t.d(r,{S:()=>d});var s=t(95155),a=t(12115),n=t(38162),l=t(72251),i=t(64269);let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.bL,{ref:r,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground","accent-amber-500","data-[state=checked]:bg-amber-500 data-[state=checked]:border-amber-500",t),...a,children:(0,s.jsx)(n.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})})});d.displayName=n.bL.displayName},86948:(e,r,t)=>{"use strict";t.d(r,{BT:()=>c,Wu:()=>o,ZB:()=>d,Zp:()=>l,aR:()=>i,wL:()=>u});var s=t(95155),a=t(12115),n=t(64269);let l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});l.displayName="Card";let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...a})});i.displayName="CardHeader";let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight text-primary",t),...a})});d.displayName="CardTitle";let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})});c.displayName="CardDescription";let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...a})});o.displayName="CardContent";let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...a})});u.displayName="CardFooter"},87270:(e,r,t)=>{"use strict";t.d(r,{A0:()=>i,BF:()=>d,Hj:()=>c,XI:()=>l,nA:()=>u,nd:()=>o});var s=t(95155),a=t(12115),n=t(64269);let l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:r,className:(0,n.cn)("w-full caption-bottom text-sm",t),...a})})});l.displayName="Table";let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("thead",{ref:r,className:(0,n.cn)("[&_tr]:border-b",t),...a})});i.displayName="TableHeader";let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("tbody",{ref:r,className:(0,n.cn)("[&_tr:last-child]:border-0",t),...a})});d.displayName="TableBody",a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("tfoot",{ref:r,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...a})}).displayName="TableFooter";let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("tr",{ref:r,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...a})});c.displayName="TableRow";let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("th",{ref:r,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...a})});o.displayName="TableHead";let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("td",{ref:r,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...a})});u.displayName="TableCell",a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("caption",{ref:r,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",t),...a})}).displayName="TableCaption"},95938:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>b});var s=t(95155),a=t(3998),n=t(86948),l=t(87270),i=t(73457),d=t(11186),c=t(76251),o=t(12115),u=t(50425),m=t(6447),f=t(88260),p=t(32078),h=t(37369);let x=(e,r)=>{let t=[],s=new Date(e);for(let e=0;e<r;e++)t.push(s.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})),s.setDate(s.getDate()+7);return t};function b(){let{people:e}=(0,u.d)(),{syncDiscoursPublics:r,isSyncing:t}=(0,h.w)(),b=(0,o.useMemo)(()=>e.filter(e=>{var r,t;return null==(t=e.assignments)||null==(r=t.weekendMeeting)?void 0:r.localSpeaker}),[e]),[g,y]=(0,o.useState)(()=>x((()=>{let e=new Date,r=e.getDay();return e.setDate(e.getDate()+(0===r?1:(8-r)%7)),e})(),52)),[j,N]=(0,o.useState)({}),v=Math.max(4,b.length),[w,k]=(0,o.useState)(()=>Array(v).fill("")),S=(0,o.useRef)(),C=(0,o.useRef)(null),R=(0,o.useCallback)(()=>{let e=g[g.length-1];if(!e)return;let r=(0,f.qg)(e,"dd/MM/yyyy",new Date),t=x((0,p.f)(r,7),52);y(e=>[...e,...t])},[g]);(0,o.useEffect)(()=>{let e=C.current;return S.current&&S.current.disconnect(),S.current=new IntersectionObserver(e=>{e[0].isIntersecting&&R()}),e&&S.current.observe(e),()=>{if(e){var r;null==(r=S.current)||r.unobserve(e)}}},[R]);let A=(0,o.useRef)(!0);return(0,o.useEffect)(()=>{if(A.current){A.current=!1;return}let t=setTimeout(async()=>{try{localStorage.setItem("programme-discours-publics-exterieur",JSON.stringify({columns:w,assignments:j,savedAt:new Date().toISOString()}))}catch(e){}let t=w.map((r,t)=>{if(!r)return null;let s=e.find(e=>e.id===r),a=Object.entries(j).filter(e=>{let[t,s]=e;return s[r]}).map(e=>{let[r]=e;return r});return{speakerId:r,speakerName:(null==s?void 0:s.displayName)||"",unavailableWeeks:a}}).filter(Boolean);await r({generatedAt:new Date().toISOString(),type:"exterieur",speakers:t})},1500);return()=>clearTimeout(t)},[w,j,e,r]),(0,s.jsxs)(n.Zp,{children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center no-print",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(n.ZB,{children:"Discours publics - Ext\xe9rieur"}),(0,s.jsx)(n.BT,{children:"S\xe9lectionnez un orateur pour chaque colonne et cochez les semaines o\xf9 ils sont absents. La liste des semaines se charge automatiquement."})]}),(0,s.jsx)(m.A,{type:"discours_publics",label:"Enregistrer & Envoyer",getPayload:()=>({generatedAt:new Date().toISOString(),weeks:g,assignments:j,columns:w}),save:()=>{try{localStorage.setItem("programme-discours-publics-exterieur",JSON.stringify({weeks:g,assignments:j,columns:w,savedAt:new Date().toISOString()}))}catch(e){}}}),(0,s.jsx)(a.Button,{variant:"ghost",size:"icon",onClick:()=>{window.print()},children:(0,s.jsx)(c.A,{className:"h-5 w-5"})})]})}),(0,s.jsxs)(n.Wu,{children:[(0,s.jsx)("div",{className:"print-only hidden my-4",children:(0,s.jsx)("h2",{className:"text-xl font-bold text-center",children:"Discours publics - Ext\xe9rieur"})}),(0,s.jsx)("div",{className:"overflow-x-auto h-[calc(100vh-250px)] printable-area",children:(0,s.jsxs)(l.XI,{children:[(0,s.jsx)(l.A0,{children:(0,s.jsxs)(l.Hj,{children:[(0,s.jsx)(l.nd,{className:"w-32 sticky top-0 left-0 bg-background z-20",children:"Semaine"}),w.map((e,r)=>{var t;return(0,s.jsxs)(l.nd,{className:"min-w-[200px] sticky top-0 bg-background z-10",children:[(0,s.jsxs)(d.l6,{value:e||"none",onValueChange:e=>((e,r)=>{let t=[...w];t[e]="none"===r?"":r,k(t)})(r,e),children:[(0,s.jsx)(d.bq,{className:"no-print",children:(0,s.jsx)(d.yv,{placeholder:"Choisir un orateur"})}),(0,s.jsxs)(d.gC,{children:[(0,s.jsx)(d.eb,{value:"none",children:(0,s.jsx)("em",{children:"Aucun"})}),b.map(e=>(0,s.jsx)(d.eb,{value:e.id,children:e.displayName},e.id))]})]}),(0,s.jsx)("span",{className:"print-only",children:(null==(t=b.find(r=>r.id===e))?void 0:t.displayName)||""})]},r)}),(0,s.jsx)(l.nd,{className:"sticky top-0 right-0 bg-background z-10 no-print",children:(0,s.jsx)(a.Button,{onClick:()=>{k(e=>[...e,""])},size:"sm",children:"Ajouter"})})]})}),(0,s.jsx)(l.BF,{children:g.map((e,r)=>(0,s.jsxs)(l.Hj,{ref:r===g.length-1?C:null,children:[(0,s.jsx)(l.nA,{className:"sticky left-0 bg-background z-10",children:e}),w.map((r,t)=>{var a;return(0,s.jsx)(l.nA,{className:"text-center",children:(0,s.jsx)(i.S,{checked:(null==(a=j[e])?void 0:a[r])||!1,onCheckedChange:()=>{r&&N(t=>{var s;let a={...t};return a[e]||(a[e]={}),a[e][r]=!(null==(s=a[e])?void 0:s[r]),a})},disabled:!r})},t)}),(0,s.jsx)(l.nA,{className:"sticky right-0 bg-background no-print"})]},e))})]})})]})]})}}},e=>{e.O(0,[830,3928,5502,4733,4244,8260,9474,7941,9325,8441,1255,7358],()=>e(e.s=55633)),_N_E=e.O()}]);