(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4472],{55457:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>W});var r=s(95155),l=s(12115),i=s(86948),a=s(87270),t=s(11186),d=s(3998),o=s(51834),c=s(65142),u=s(76444),m=s(18332),h=s(26333),x=s(50276),j=s(51190),p=s(28127),g=s(63263),f=s(13630),w=s(18771),v=s(76251),k=s(5418),S=s(60406),N=s(64480),b=s(63146),M=s(38621),A=s(61470),C=s(87915),y=s(26146),G=s(50425),B=s(6447),P=s(37369);function W(){let{people:e,preachingGroups:n}=(0,G.d)(),{syncNettoyage:s,isSyncing:o}=(0,P.w)(),[c,m]=(0,l.useState)(()=>((e,n)=>{let s=[];for(let n=0;n<52;n++){let r=(0,N.J)(e,n),l=(0,b.$)(r,{locale:C.fr}),i=(e,n)=>{let s=(0,M.GP)(e,"MMMM",{locale:C.fr}),r=(0,M.GP)(n,"MMMM",{locale:C.fr}),l=(0,M.GP)(e,"dd",{locale:C.fr}),i=(0,M.GP)(n,"dd",{locale:C.fr});return s===r?s+" "+l+"-"+i:s+" "+l+" - "+r+" "+i};s.push(i(r,l))}return s})((0,A.k)(new Date,{locale:C.fr}),0).map(e=>({week:e,reunionSemaine:"",reunionWeekend:""}))),[k,S]=(0,l.useState)(new Date),[W,D]=(0,l.useState)((()=>{let e=new Date,n=(0,A.k)(e,{locale:C.fr}),s=(0,b.$)(e,{locale:C.fr}),r=(0,M.GP)(n,"MMMM",{locale:C.fr}),l=(0,M.GP)(s,"MMMM",{locale:C.fr}),i=(0,M.GP)(n,"dd",{locale:C.fr}),a=(0,M.GP)(s,"dd",{locale:C.fr});return r===l?r+" "+i+"-"+a:r+" "+i+" - "+l+" "+a})()),O=n.map(e=>({value:e.id,label:e.name})),R=(e,r)=>{m(l=>{let i=l.map(s=>{if(s.week===W){let l=r.map(e=>{let s=n.find(n=>n.id===e);return s?s.name:""}).filter(Boolean);return{...s,[e]:l.join(", ")}}return s});return i.find(e=>e.week===W)&&s({date:(null==k?void 0:k.toISOString())||new Date().toISOString(),groups:n.filter(e=>r.includes(e.id)),assignments:i}),i})},E=(0,l.useRef)(!0);(0,l.useEffect)(()=>{if(E.current){E.current=!1;return}let e=setTimeout(()=>{console.log("Sauvegarde automatique des donnees...",c)},1e3);return()=>clearTimeout(e)},[c]);let q=c.find(e=>e.week===W),F=e=>{if(!e)return[];let s=e.split(", ").filter(Boolean);return n.filter(e=>s.includes(e.name)).map(e=>e.id)};return(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Organisation du Nettoyage"}),(0,r.jsx)(i.BT,{children:"Repartition du nettoyage par groupe de predication pour chaque reunion."})]}),(0,r.jsxs)(i.Wu,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6 p-4 border rounded-lg bg-muted/40",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Label,{htmlFor:"week-select",className:"sr-only",children:"Semaine"}),(0,r.jsxs)(t.l6,{value:W,onValueChange:D,children:[(0,r.jsx)(t.bq,{id:"week-select",className:"w-[200px]",children:(0,r.jsx)(t.yv,{placeholder:"Selectionner une semaine"})}),(0,r.jsx)(t.gC,{children:c.map(e=>(0,r.jsx)(t.eb,{value:e.week,children:e.week},e.week))})]}),(0,r.jsx)(d.Button,{variant:"ghost",size:"icon",children:(0,r.jsx)(j.A,{className:"h-4 w-4"})}),(0,r.jsxs)(h.AM,{children:[(0,r.jsx)(h.Wv,{asChild:!0,children:(0,r.jsx)(d.Button,{variant:"ghost",size:"icon",children:(0,r.jsx)(p.A,{className:"h-4 w-4"})})}),(0,r.jsx)(h.hl,{className:"w-auto p-0",onInteractOutside:e=>{e.preventDefault()},children:(0,r.jsx)(x.V,{mode:"single",selected:k,onSelect:e=>{if(!e)return;S(e);let n=(0,A.k)(e,{locale:C.fr}),s=(0,b.$)(e,{locale:C.fr}),r=(0,M.GP)(n,"MMMM",{locale:C.fr}),l=(0,M.GP)(s,"MMMM",{locale:C.fr}),i=(0,M.GP)(n,"dd",{locale:C.fr}),a=(0,M.GP)(s,"dd",{locale:C.fr});D(r===l?r+" "+i+"-"+a:r+" "+i+" - "+l+" "+a)},initialFocus:!0})})]}),(0,r.jsx)(d.Button,{variant:"ghost",size:"icon",children:(0,r.jsx)(g.A,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(d.Button,{variant:"outline",onClick:()=>{m(e=>e.map(e=>e.week===W?{...e,reunionSemaine:"",reunionWeekend:""}:e))},children:[(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"}),"Effacer"]}),(0,r.jsx)(I,{preachingGroups:n,cleaningData:c,setCleaningData:m}),(0,r.jsxs)(d.Button,{variant:"outline",children:[(0,r.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Partager"]}),(0,r.jsxs)(d.Button,{variant:"outline",children:[(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Imprimer"]}),(0,r.jsx)(B.A,{type:"nettoyage",label:"Enregistrer & Envoyer",getPayload:()=>{let e=new Date().toISOString(),n=c.find(e=>e.week===W);return{generatedAt:e,selectedWeek:W,reunionSemaine:(null==n?void 0:n.reunionSemaine)||"",reunionWeekend:(null==n?void 0:n.reunionWeekend)||"",cleaningData:c.slice(0,12)}},save:()=>localStorage.setItem("programme-nettoyage",JSON.stringify({cleaningData:c,savedAt:new Date().toISOString()}))})]})]}),(0,r.jsxs)(a.XI,{children:[(0,r.jsx)(a.A0,{children:(0,r.jsxs)(a.Hj,{children:[(0,r.jsx)(a.nd,{className:"w-[200px]",children:"Semaine"}),(0,r.jsx)(a.nd,{children:"Reunion de semaine"}),(0,r.jsx)(a.nd,{children:"Reunion de week-end"})]})}),(0,r.jsx)(a.BF,{children:(0,r.jsxs)(a.Hj,{className:q?"bg-muted/50":"",children:[(0,r.jsx)(a.nA,{className:"font-medium",children:W}),(0,r.jsx)(a.nA,{children:(0,r.jsx)(y.K,{options:O,selected:F((null==q?void 0:q.reunionSemaine)||""),onChange:e=>R("reunionSemaine",e),placeholder:"Selectionner groupe(s)..."})}),(0,r.jsx)(a.nA,{children:(0,r.jsx)(y.K,{options:O,selected:F((null==q?void 0:q.reunionWeekend)||""),onChange:e=>R("reunionWeekend",e),placeholder:"Selectionner groupe(s)..."})})]})})]}),(0,r.jsxs)("div",{className:"mt-8",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Apercu du programme"}),(0,r.jsxs)(a.XI,{children:[(0,r.jsx)(a.A0,{children:(0,r.jsxs)(a.Hj,{children:[(0,r.jsx)(a.nd,{className:"w-[200px]",children:"Semaine"}),(0,r.jsx)(a.nd,{children:"Reunion de semaine"}),(0,r.jsx)(a.nd,{children:"Reunion de week-end"})]})}),(0,r.jsx)(a.BF,{children:c.slice(0,12).map(e=>(0,r.jsxs)(a.Hj,{className:e.week===W?"bg-muted/50":"",children:[(0,r.jsx)(a.nA,{className:"font-medium",children:e.week}),(0,r.jsx)(a.nA,{children:e.reunionSemaine||"-"}),(0,r.jsx)(a.nA,{children:e.reunionWeekend||"-"})]},e.week))})]})]})]})]})}function I(e){let{preachingGroups:n,cleaningData:s,setCleaningData:i}=e,[a,h]=(0,l.useState)(12),[x,j]=(0,l.useState)(1),[p,g]=(0,l.useState)(!1);return(0,r.jsxs)(o.lG,{open:p,onOpenChange:g,children:[(0,r.jsx)(o.zM,{asChild:!0,children:(0,r.jsxs)(d.Button,{variant:"outline",children:[(0,r.jsx)(k.A,{className:"mr-2 h-4 w-4"}),"Saisie automatique"]})}),(0,r.jsxs)(o.Cf,{children:[(0,r.jsx)(o.c7,{children:(0,r.jsx)(o.L3,{children:"Repartition automatique par groupes"})}),(0,r.jsxs)("div",{className:"py-4 space-y-4",children:[(0,r.jsxs)(m.Fc,{children:[(0,r.jsx)(S.A,{className:"h-4 w-4"}),(0,r.jsx)(m.TN,{children:"Cette action va repartir les groupes de predication en rotation sur les semaines selectionnees. Les attributions existantes seront remplacees."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(u.Label,{htmlFor:"weeks-count",children:"Nombre de semaines a repartir"}),(0,r.jsx)(c.p,{id:"weeks-count",type:"number",min:1,max:52,value:a,onChange:e=>h(parseInt(e.target.value)||12)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(u.Label,{children:"Nombre de groupes pour les deux reunions"}),(0,r.jsxs)(t.l6,{value:String(x),onValueChange:e=>j(parseInt(e)),children:[(0,r.jsx)(t.bq,{children:(0,r.jsx)(t.yv,{})}),(0,r.jsxs)(t.gC,{children:[(0,r.jsx)(t.eb,{value:"1",children:"1 groupe (meme groupe semaine et week-end)"}),(0,r.jsx)(t.eb,{value:"2",children:"2 groupes (1 semaine, 1 week-end)"}),(0,r.jsx)(t.eb,{value:"4",children:"4 groupes (2 semaine, 2 week-end)"})]})]})]}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Groupes disponibles: ",n.map(e=>e.name).join(", ")||"Aucun"]})]}),(0,r.jsxs)(o.Es,{children:[(0,r.jsx)(o.HM,{asChild:!0,children:(0,r.jsx)(d.Button,{variant:"outline",children:"Annuler"})}),(0,r.jsx)(d.Button,{onClick:()=>{if(0===n.length)return void alert("Aucun groupe de predication disponible.");i(e=>{let s=[...e],r=n.length,l=0;for(let e=0;e<a&&e<s.length;e++)if(1===x){let i=n[l%r].name;s[e]={...s[e],reunionSemaine:i,reunionWeekend:i},l++}else if(2===x){let i=n[l%r].name,a=n[(l+1)%r].name;s[e]={...s[e],reunionSemaine:i,reunionWeekend:a},l+=2}else if(4===x){let i=n[l%r].name,a=n[(l+1)%r].name,t=n[(l+2)%r].name,d=n[(l+3)%r].name;s[e]={...s[e],reunionSemaine:i+", "+a,reunionWeekend:t+", "+d},l+=4}return s}),g(!1)},children:"Repartir les groupes"})]})]})]})}},84606:(e,n,s)=>{Promise.resolve().then(s.bind(s,55457))}},e=>{e.O(0,[830,3928,5502,4733,9823,4244,4325,4589,2275,5392,7941,9325,5148,8441,1255,7358],()=>e(e.s=84606)),_N_E=e.O()}]);