(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6696],{32265:(e,l,s)=>{"use strict";s.d(l,{A:()=>a});let a=(0,s(14294).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},50824:(e,l,s)=>{Promise.resolve().then(s.bind(s,80911))},80911:(e,l,s)=>{"use strict";s.r(l),s.d(l,{default:()=>z});var a=s(95155),t=s(12115),n=s(86948),r=s(87270),i=s(11186),c=s(3998),o=s(51834),d=s(73457),u=s(65142),h=s(76444),m=s(18332),x=s(26333),p=s(50276),j=s(51190),v=s(28127),f=s(63263),g=s(13630),N=s(76251),b=s(18771),S=s(26615),w=s(32265),A=s(5418),y=s(60406),M=s(64480),C=s(63146),k=s(38621),E=s(61470),P=s(87915),B=s(26146),D=s(50425),O=s(6447),G=s(37369);function I(e,l){return e.filter(e=>(null==e?void 0:e.displayName)&&""!==e.displayName.trim()).filter(e=>(function(e,l){var s;let a=null==e||null==(s=e.assignments)?void 0:s.services;switch(l){case"Comptage_Assistance":return!!(null==a?void 0:a.attendanceCount);case"Accueil \xe0 la porte":return!!((null==a?void 0:a.doorAttendant)||(null==a?void 0:a.doorAttendantAlt));case"Sonorisation":return!!(null==a?void 0:a.soundSystem);case"Micros baladeur":return!!(null==a?void 0:a.rovingMic);case"Micros Estrade":return!!((null==a?void 0:a.stageMic)||(null==a?void 0:a.stageMicAlt));case"Sanitaire":return!!(null==a?void 0:a.sanitary);case"Accueil dans la salle":return!!((null==a?void 0:a.hallAttendant)||(null==a?void 0:a.hallAttendantAlt));case"Accueil \xe0 la grande porte":return!!((null==a?void 0:a.mainDoorAttendant)||(null==a?void 0:a.mainDoorAttendantAlt));default:return!0}})(e,l))}let _=["Comptage_Assistance","Accueil \xe0 la porte","Sonorisation","Micros baladeur","Micros Estrade","Sanitaire","Accueil dans la salle","Accueil \xe0 la grande porte","Entretien"],F={Comptage_Assistance:2,"Accueil \xe0 la porte":2,Sonorisation:2,"Micros baladeur":4,"Micros Estrade":2,Sanitaire:2,"Accueil dans la salle":2,"Accueil \xe0 la grande porte":2,Entretien:1},L=()=>{let e=new Date,l=(0,E.k)(e,{locale:P.fr}),s=(0,C.$)(e,{locale:P.fr}),a=(0,k.GP)(l,"MMMM",{locale:P.fr}),t=(0,k.GP)(s,"MMMM",{locale:P.fr}),n=(0,k.GP)(l,"dd",{locale:P.fr}),r=(0,k.GP)(s,"dd",{locale:P.fr});return a===t?"".concat(a," ").concat(n,"–").concat(r):"".concat(a," ").concat(n,"–").concat(t," ").concat(r)};function z(){let{people:e,preachingGroups:l}=(0,D.d)(),{syncServices:s,isSyncing:o}=(0,G.w)(),[d,u]=(0,t.useState)(_),[m,w]=(0,t.useState)(F),[A,y]=(0,t.useState)(()=>((e,l)=>{let s=[];for(let l=0;l<24;l++){let a=(0,M.J)(e,l),t=(0,C.$)(a,{locale:P.fr}),n=(e,l)=>{let s=(0,k.GP)(e,"MMMM",{locale:P.fr}),a=(0,k.GP)(l,"MMMM",{locale:P.fr}),t=(0,k.GP)(e,"dd",{locale:P.fr}),n=(0,k.GP)(l,"dd",{locale:P.fr});return s===a?"".concat(s," ").concat(t,"–").concat(n):"".concat(s," ").concat(t,"–").concat(a," ").concat(n)};s.push(n(a,t))}return s})((0,E.k)(new Date,{locale:P.fr}),0).map(e=>({week:e,..._.reduce((e,l)=>({...e,[l]:[]}),{})}))),[z,T]=(0,t.useState)(new Date),[V,J]=(0,t.useState)(L()),R=e.filter(e=>(null==e?void 0:e.id)&&(null==e?void 0:e.displayName)&&""!==e.displayName.trim()).map(e=>({value:e.id,label:e.displayName})),$=l.map(e=>({value:e.id,label:e.name})),W=(0,t.useRef)(!0);(0,t.useEffect)(()=>{if(W.current){W.current=!1;return}let e=setTimeout(async()=>{console.log("Sauvegarde automatique des donn\xe9es...",A),localStorage.setItem("programme-services",JSON.stringify({roles:d,rolePersonCounts:m,serviceData:A,savedAt:new Date().toISOString()}));let e=[],l=A.find(e=>e.week===V),a=z?z.toISOString():new Date().toISOString();l&&d.forEach(s=>{var t;let n=null!=(t=l[s])?t:[];n&&n.length&&e.push({date:a,service:s,users:n})}),await s({type:"services",date:a,assignments:e})},1500);return()=>clearTimeout(e)},[A,d,m,V,z,s]);let Z=A.find(e=>e.week===V);return(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"no-print",children:[(0,a.jsx)(n.ZB,{children:"Organisation Hebdomadaire des Affectations de Service"}),(0,a.jsx)(n.BT,{children:"Planifiez et visualisez les affectations de service pour chaque semaine."})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6 p-4 border rounded-lg bg-muted/40 no-print",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Label,{htmlFor:"week-select",className:"sr-only",children:"Semaine"}),(0,a.jsxs)(i.l6,{value:V,onValueChange:J,children:[(0,a.jsx)(i.bq,{id:"week-select",className:"w-[200px]",children:(0,a.jsx)(i.yv,{placeholder:"S\xe9lectionner une semaine"})}),(0,a.jsx)(i.gC,{children:A.map(e=>(0,a.jsx)(i.eb,{value:e.week,children:e.week},e.week))})]}),(0,a.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(j.A,{className:"h-4 w-4"})}),(0,a.jsxs)(x.AM,{children:[(0,a.jsx)(x.Wv,{asChild:!0,children:(0,a.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(v.A,{className:"h-4 w-4"})})}),(0,a.jsx)(x.hl,{className:"w-auto p-0",onInteractOutside:e=>{e.preventDefault()},children:(0,a.jsx)(p.V,{mode:"single",selected:z,onSelect:e=>{if(!e)return;T(e);let l=(0,E.k)(e,{locale:P.fr}),s=(0,C.$)(e,{locale:P.fr}),a=(0,k.GP)(l,"MMMM",{locale:P.fr}),t=(0,k.GP)(s,"MMMM",{locale:P.fr}),n=(0,k.GP)(l,"dd",{locale:P.fr}),r=(0,k.GP)(s,"dd",{locale:P.fr});J(a===t?"".concat(a," ").concat(n,"–").concat(r):"".concat(a," ").concat(n,"–").concat(t," ").concat(r))},initialFocus:!0})})]}),(0,a.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(f.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(q,{onAddService:(e,l)=>{let s=e.replace(/ /g,"_");if(d.includes(s))return void alert("Ce service existe d\xe9j\xe0.");u(e=>[...e,s]),w(e=>({...e,[s]:l})),y(e=>e.map(e=>({...e,[s]:[]})))}}),(0,a.jsxs)(c.Button,{variant:"outline",onClick:()=>{y(e=>e.map(e=>{if(e.week===V){let l={...e};return d.forEach(e=>{l[e]=[]}),l}return e}))},children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Effacer"]}),(0,a.jsx)(H,{rolePersonCounts:m,preachingGroups:l,serviceData:A,setServiceData:y,people:e}),(0,a.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>{window.print()},children:(0,a.jsx)(N.A,{className:"h-4 w-4"})}),(0,a.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(b.A,{className:"h-4 w-4"})}),(0,a.jsx)(O.A,{type:"services",label:"Enregistrer & Envoyer les Services",getPayload:()=>{let e=new Date().toISOString(),l=A.find(e=>e.week===V),s=[],a=z?z.toISOString():new Date().toISOString();return l&&d.forEach(e=>{var t;let n=null!=(t=l[e])?t:[];n&&n.length&&s.push({date:a,service:e,users:n})}),{generatedAt:e,roles:d,rolePersonCounts:m,serviceData:A,items:s}},save:()=>localStorage.setItem("programme-services",JSON.stringify({roles:d,rolePersonCounts:m,serviceData:A,savedAt:new Date().toISOString()}))})]})]}),(0,a.jsxs)("div",{className:"mb-8 no-print",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4 text-red-500 text-center",children:V}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:d.map(s=>{let t,n="Entretien"===s,r=(null==Z?void 0:Z[s])||[];t=n?l.filter(e=>r.includes(e.name)).map(e=>e.id):e.filter(e=>r.includes(e.displayName)).map(e=>e.id);let i=n?[]:I(e,s),o=n?[]:e.filter(e=>t.includes(e.id)),d=n?$:(()=>{let e=[...i,...o],l=new Map;return(e.forEach(e=>{(null==e?void 0:e.id)&&(null==e?void 0:e.displayName)&&l.set(e.id,{value:e.id,label:e.displayName})}),l.size>0)?Array.from(l.values()):R})();return(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(h.Label,{children:s.replace(/_/g," ")}),(0,a.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>{u(e=>e.filter(e=>e!==s)),w(e=>{let l={...e};return delete l[s],l}),y(e=>e.map(e=>{let l={...e};return delete l[s],l}))},children:(0,a.jsx)(S.A,{className:"h-4 w-4"})})]}),(0,a.jsx)(B.K,{options:d,selected:t,onChange:a=>{y(t=>t.map(t=>{if(t.week===V){let n;return n="Entretien"===s?a.map(e=>{let s=l.find(l=>l.id===e);return s?s.name:""}).filter(Boolean):a.map(l=>{let s=e.find(e=>e.id===l);return s?s.displayName:""}).filter(Boolean),{...t,[s]:n}}return t}))},placeholder:"S\xe9lectionner..."})]},s)})})]}),(0,a.jsxs)("div",{className:"overflow-x-auto printable-area",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4 text-center print-only hidden",children:"Programme des services - Semaine du ".concat(V)}),(0,a.jsxs)(r.XI,{children:[(0,a.jsx)(r.A0,{children:(0,a.jsxs)(r.Hj,{children:[(0,a.jsx)(r.nd,{className:"w-[180px]",children:"Date"}),d.map(e=>(0,a.jsx)(r.nd,{children:e.replace(/_/g," ")},e))]})}),(0,a.jsx)(r.BF,{children:A.map(e=>(0,a.jsxs)(r.Hj,{className:e.week===L()?"bg-yellow-100/70":"",children:[(0,a.jsx)(r.nA,{className:"font-medium",children:e.week}),d.map(l=>(0,a.jsx)(r.nA,{children:(0,a.jsx)("div",{className:"flex flex-col gap-1",children:(e[l]||[]).map((e,l)=>(0,a.jsx)("span",{className:"h-6",children:e},l))})},l))]},e.week))})]})]})]})]})}function q(e){let{onAddService:l}=e,[s,n]=(0,t.useState)(!1),[r,i]=(0,t.useState)(""),[d,m]=(0,t.useState)(1);return(0,a.jsxs)(o.lG,{open:s,onOpenChange:n,children:[(0,a.jsx)(o.zM,{asChild:!0,children:(0,a.jsxs)(c.Button,{variant:"outline",children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Ajouter un service"]})}),(0,a.jsxs)(o.Cf,{className:"sm:max-w-[425px]",children:[(0,a.jsx)(o.c7,{children:(0,a.jsx)(o.L3,{children:"Ajouter un nouveau service"})}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(h.Label,{htmlFor:"role-name",className:"text-right",children:"Nom"}),(0,a.jsx)(u.p,{id:"role-name",value:r,onChange:e=>i(e.target.value),className:"col-span-3",placeholder:"Ex: Entretien"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(h.Label,{htmlFor:"person-count",className:"text-right",children:"Personnes"}),(0,a.jsx)(u.p,{id:"person-count",type:"number",value:d,onChange:e=>m(parseInt(e.target.value,10)||1),className:"col-span-3",min:"1"})]})]}),(0,a.jsx)(o.Es,{children:(0,a.jsx)(c.Button,{onClick:()=>{r.trim()&&(l(r.trim(),d),i(""),m(1),n(!1))},children:"Ajouter le service"})})]})]})}function H(e){let{rolePersonCounts:l,preachingGroups:s,serviceData:n,setServiceData:r,people:u}=e,[x,p]=(0,t.useState)(!1),[j,v]=(0,t.useState)(4),[f,g]=(0,t.useState)({});return(0,a.jsxs)(o.lG,{open:x,onOpenChange:p,children:[(0,a.jsx)(o.zM,{asChild:!0,children:(0,a.jsxs)(c.Button,{variant:"outline",children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"Saisie automatique"]})}),(0,a.jsxs)(o.Cf,{className:"sm:max-w-[600px]",children:[(0,a.jsx)(o.c7,{children:(0,a.jsx)(o.L3,{children:"Param\xe8tres de la saisie automatique"})}),(0,a.jsxs)("div",{className:"grid gap-6 py-4 max-h-[60vh] overflow-y-auto pr-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(h.Label,{className:"font-semibold",children:"Choisir les r\xf4les et le nombre de personnes"}),Object.entries(l).map(e=>{let[l,s]=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(h.Label,{htmlFor:l,className:"flex-1",children:l.replace(/_/g," ")}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:[...Array(s)].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(d.S,{id:"".concat(l,"-").concat(s+1),checked:f[l]===s+1,onCheckedChange:()=>{var e;return e=s+1,void g(s=>({...s,[l]:s[l]===e?0:e}))}}),(0,a.jsx)(h.Label,{htmlFor:"".concat(l,"-").concat(s+1),className:"text-sm font-normal",children:s+1})]},s))})]},l)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(h.Label,{htmlFor:"weeks-count",children:"Semaines pour l'attribution"}),(0,a.jsxs)(i.l6,{value:String(j),onValueChange:e=>v(parseInt(e)),children:[(0,a.jsx)(i.bq,{id:"weeks-count",children:(0,a.jsx)(i.yv,{placeholder:"Nombre de semaines"})}),(0,a.jsx)(i.gC,{children:[2,3,4,5,6,7,8].map(e=>(0,a.jsxs)(i.eb,{value:String(e),children:[e," semaines"]},e))})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(h.Label,{htmlFor:"attribution-criteria",children:"Command\xe9 par"}),(0,a.jsxs)(i.l6,{children:[(0,a.jsx)(i.bq,{id:"attribution-criteria",children:(0,a.jsx)(i.yv,{placeholder:"Crit\xe8re d'attribution"})}),(0,a.jsxs)(i.gC,{children:[(0,a.jsx)(i.eb,{value:"recent",children:"Service r\xe9cent"}),(0,a.jsx)(i.eb,{value:"rotation",children:"Rotation"}),(0,a.jsx)(i.eb,{value:"random",children:"Al\xe9atoire"})]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,a.jsx)(d.S,{id:"check-existing",defaultChecked:!0}),(0,a.jsx)(h.Label,{htmlFor:"check-existing",className:"font-normal",children:"V\xe9rifier l’attribution existante"})]}),(0,a.jsxs)(m.Fc,{variant:"destructive",className:"mt-4",children:[(0,a.jsx)(y.A,{className:"h-4 w-4"}),(0,a.jsx)(m.TN,{children:"Cette action va \xe9craser toutes les futures affectations pour les r\xf4les et semaines s\xe9lectionn\xe9s."})]})]}),(0,a.jsxs)(o.Es,{children:[(0,a.jsx)(o.HM,{asChild:!0,children:(0,a.jsx)(c.Button,{type:"button",variant:"secondary",children:"❌ Annuler"})}),(0,a.jsx)(c.Button,{type:"button",onClick:()=>{let e=u.filter(e=>e.displayName&&""!==e.displayName.trim());if(0===e.length&&0===s.length)return void alert("Aucune personne ou groupe disponible.");r(l=>{let a=[...l];for(let l=0;l<j&&l<a.length;l++){let t={...a[l]};Object.entries(f).forEach(a=>{let[n,r]=a;if(r>0)if("Entretien"===n){if(s.length>0){let e=l%s.length;t[n]=[s[e].name]}}else{let s=I(e,n),a=s.length>0?s:e,i=[];for(let e=0;e<r&&e<a.length;e++){let s=(l*r+e)%a.length;i.push(a[s].displayName)}t[n]=i}}),a[l]=t}return a}),p(!1)},children:"\uD83D\uDFE6 Saisie automatique"})]})]})]})}}},e=>{e.O(0,[830,3928,5502,4733,9823,4244,4325,4589,2275,5392,7941,9325,5148,8441,1255,7358],()=>e(e.s=50824)),_N_E=e.O()}]);