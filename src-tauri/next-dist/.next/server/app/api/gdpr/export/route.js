(()=>{var e={};e.id=2326,e.ids=[2326],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29008:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>d,serverHooks:()=>h,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>u});var o=r(96559),a=r(48088),n=r(37719),i=r(32190),l=r(59608),c=r(83888);async function u(e){return(0,l.fZ)(e,async e=>{try{let t,r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return i.NextResponse.json({error:"Unauthorized"},{status:401});let s=r.substring(7);try{t=c.LC.verifyToken(s).userId}catch(e){return i.NextResponse.json({error:"Invalid token"},{status:401})}c.SB.log("GDPR_EXPORT_REQUEST",t,{timestamp:new Date().toISOString(),ipAddress:e.headers.get("x-forwarded-for")});let o={userId:t,exportDate:new Date().toISOString(),data:{profile:{name:"John Doe",email:"john@example.com"},people:[],territories:[],assignments:[]}},a=c.LC.encrypt(o),n=i.NextResponse.json({success:!0,data:a,format:"encrypted-json",algorithm:"AES-256-GCM"},{status:200});return c.SB.log("GDPR_EXPORT_SUCCESS",t,{dataSize:JSON.stringify(o).length,exportTime:new Date().toISOString()}),n}catch(e){return console.error("Export error:",e),c.SB.log("GDPR_EXPORT_FAILED","unknown",{error:String(e)}),i.NextResponse.json({error:"Export failed"},{status:500})}},{allowedMethods:["POST"],rateLimit:l.pk.dataExport,rateLimitId:"gdpr-export",requireAuth:!0})}let d=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/gdpr/export/route",pathname:"/api/gdpr/export",filename:"route",bundlePath:"app/api/gdpr/export/route"},resolvedPagePath:"C:\\Users\\Public\\Documents\\app-gestionnaire\\src\\app\\api\\gdpr\\export\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:g,serverHooks:h}=d;function m(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:g})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},59608:(e,t,r)=>{"use strict";r.d(t,{fZ:()=>n,pk:()=>a});var s=r(32190);let o={},a={login:5,signup:3,apiCall:100,dataExport:2,dataDelete:1};async function n(e,t,r={}){let{allowedMethods:i=["POST"],rateLimit:l=a.apiCall,rateLimitId:c="default",requireAuth:u=!1}=r,d=function(e,t=["POST"]){if(!t.includes(e.method))return{valid:!1,error:`Method ${e.method} not allowed`};if(["POST","PUT"].includes(e.method)){let t=e.headers.get("content-type");if(!t?.includes("application/json"))return{valid:!1,error:"Content-Type must be application/json"}}let r=e.headers.get("origin"),s=process.env.NEXT_PUBLIC_CORS_ORIGIN||"http://localhost:3000";return r&&!r.includes(s)?{valid:!1,error:"CORS origin not allowed"}:{valid:!0}}(e,i);if(!d.valid)return s.NextResponse.json({error:d.error},{status:400});let{allowed:p,remaining:g,resetTime:h}=function(e,t=a.apiCall){let r=Date.now(),s=o[e];return!s||r>s.resetTime?(o[e]={count:1,resetTime:r+9e5},{allowed:!0,remaining:t-1,resetTime:o[e].resetTime}):(s.count++,{allowed:s.count<=t,remaining:Math.max(0,t-s.count),resetTime:s.resetTime})}(function(e,t="default"){let r=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";return`${r}:${t}`}(e,c),l);if(!p)return s.NextResponse.json({error:"Too many requests",retryAfter:Math.ceil((h-Date.now())/1e3)},{status:429,headers:{"X-RateLimit-Remaining":"0","Retry-After":String(Math.ceil((h-Date.now())/1e3))}});if(u){let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return s.NextResponse.json({error:"Missing or invalid authorization header"},{status:401})}try{let r=await t(e);return r.headers.set("X-RateLimit-Limit",String(l)),r.headers.set("X-RateLimit-Remaining",String(g)),r.headers.set("X-RateLimit-Reset",String(Math.ceil(h/1e3))),r.headers.set("X-Content-Type-Options","nosniff"),r.headers.set("X-Frame-Options","DENY"),r}catch(e){return console.error("API Error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},83888:(e,t,r)=>{"use strict";r.d(t,{Bu:()=>n,LC:()=>a,SB:()=>i});var s=r(40383),o=r.n(s);class a{static{this.ENCRYPTION_KEY=process.env.NEXT_PUBLIC_ENCRYPTION_KEY||"fallback-key-256-bit-change-in-production"}static encrypt(e){try{let t=JSON.stringify(e);return o().AES.encrypt(t,this.ENCRYPTION_KEY).toString()}catch(e){throw console.error("Erreur de chiffrement:",e),Error("Impossible de chiffrer les donn\xe9es")}}static decrypt(e){try{let t=o().AES.decrypt(e,this.ENCRYPTION_KEY).toString(o().enc.Utf8);return JSON.parse(t)}catch(e){throw console.error("Erreur de d\xe9chiffrement:",e),Error("Impossible de d\xe9chiffrer les donn\xe9es")}}static hashPassword(e){return o().PBKDF2(e,this.ENCRYPTION_KEY,{keySize:8,iterations:1e3}).toString()}static verifyPassword(e,t){return this.hashPassword(e)===t}static generateSecureKey(e=32){let t=new Uint8Array(e);return crypto.getRandomValues(t),Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}static createToken(e,t=24){let r=btoa(JSON.stringify({alg:"HS256",typ:"JWT"})),s=btoa(JSON.stringify({...e,iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+3600*t})),a=o().HmacSHA256(`${r}.${s}`,this.ENCRYPTION_KEY).toString();return`${r}.${s}.${a}`}static verifyToken(e){try{let t=e.split(".");if(3!==t.length)throw Error("Token invalide");let[r,s,a]=t,n=o().HmacSHA256(`${r}.${s}`,this.ENCRYPTION_KEY).toString();if(a!==n)throw Error("Signature invalide");let i=JSON.parse(atob(s));if(i.exp<Math.floor(Date.now()/1e3))throw Error("Token expir\xe9");return i}catch(e){throw console.error("Erreur de v\xe9rification du token:",e),Error("Token invalide")}}static sanitize(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}static maskSensitiveData(e){let t={...e};return["password","email","phone","ssn","creditCard"].forEach(e=>{t[e]&&(t[e]="***MASKED***")}),t}}class n{static setItem(e,t){try{let r=a.encrypt(t);localStorage.setItem(e,r)}catch(t){console.error(`Erreur lors de la sauvegarde de ${e}:`,t)}}static getItem(e){try{let t=localStorage.getItem(e);if(!t)return null;return a.decrypt(t)}catch(t){return console.error(`Erreur lors de la lecture de ${e}:`,t),null}}static removeItem(e){localStorage.removeItem(e)}static clear(){localStorage.clear()}}class i{static log(e,t,r){let s={timestamp:new Date().toISOString(),action:e,userId:t,details:a.maskSensitiveData(r),ipAddress:"client-side",userAgent:navigator.userAgent};try{let e=n.getItem("audit_logs")||[];e.push(s),e.length>1e3&&e.shift(),n.setItem("audit_logs",e)}catch(e){console.error("Erreur lors de l'audit logging:",e)}}static getLogs(){return n.getItem("audit_logs")||[]}static clearLogs(){n.removeItem("audit_logs")}}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,383],()=>r(29008));module.exports=s})();