(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6696],{44970:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>D});var l=a(95155),n=a(12115),t=a(66695),r=a(85127),i=a(59409),c=a(30285),o=a(54165),d=a(47262),m=a(62523),u=a(85057),x=a(55365),h=a(14636),j=a(85511),p=a(965),f=a(51920),g=a(73158),v=a(77223),N=a(18018),b=a(7390),w=a(25318),M=a(18046),C=a(73503),A=a(31949),k=a(96019),S=a(65119),y=a(41784),E=a(34548),P=a(16946),B=a(4313),G=a(32714);let L=["Comptage_Assistance","Accueil \xe0 la porte","Sonorisation","Micros baladeur","Micros Estrade","Sanitaire","Accueil dans la salle","Accueil \xe0 la grande porte","Entretien"],F={Comptage_Assistance:2,"Accueil \xe0 la porte":2,Sonorisation:2,"Micros baladeur":4,"Micros Estrade":2,Sanitaire:2,"Accueil dans la salle":2,"Accueil \xe0 la grande porte":2,Entretien:1},_=(e,s)=>{let a=[];for(let l=0;l<s;l++){let s=(0,k.J)(e,l),n=(0,S.$)(s,{locale:P.fr}),t=(e,s)=>{let a=(0,y.GP)(e,"MMMM",{locale:P.fr}),l=(0,y.GP)(s,"MMMM",{locale:P.fr}),n=(0,y.GP)(e,"dd",{locale:P.fr}),t=(0,y.GP)(s,"dd",{locale:P.fr});return a===l?"".concat(a," ").concat(n,"–").concat(t):"".concat(a," ").concat(n,"–").concat(l," ").concat(t)};a.push(t(s,n))}return a},q=()=>{let e=new Date,s=(0,E.k)(e,{locale:P.fr}),a=(0,S.$)(e,{locale:P.fr}),l=(0,y.GP)(s,"MMMM",{locale:P.fr}),n=(0,y.GP)(a,"MMMM",{locale:P.fr}),t=(0,y.GP)(s,"dd",{locale:P.fr}),r=(0,y.GP)(a,"dd",{locale:P.fr});return l===n?"".concat(l," ").concat(t,"–").concat(r):"".concat(l," ").concat(t,"–").concat(n," ").concat(r)},z=e=>_((0,E.k)(new Date,{locale:P.fr}),24).map(s=>({week:s,...e.reduce((e,s)=>({...e,[s]:[]}),{})}));function D(){let{people:e}=(0,G.d)(),[s,a]=(0,n.useState)(L),[o,d]=(0,n.useState)(F),[m,x]=(0,n.useState)(()=>z(L)),[M,C]=(0,n.useState)(new Date),[A,k]=(0,n.useState)(q()),_=e.map(e=>({value:e.id,label:e.displayName})),D=(0,n.useMemo)(()=>{let s={};return e.forEach(e=>{let a=e.spiritual.group||"unassigned";"unassigned"!==a&&(s[a]||(s[a]=[]),s[a].push(e))}),Object.keys(s).sort().map((e,s)=>({id:e,name:"Groupe ".concat(s+1)}))},[e]),T=D.map(e=>({value:e.id,label:e.name})),I=(s,a)=>{x(l=>l.map(l=>{if(l.week===A){let n;return n="Entretien"===s?a.map(e=>{let s=D.find(s=>s.id===e);return s?s.name:""}).filter(Boolean):a.map(s=>{let a=e.find(e=>e.id===s);return a?a.displayName:""}).filter(Boolean),{...l,[s]:n}}return l}))},R=e=>{a(s=>s.filter(s=>s!==e)),d(s=>{let a={...s};return delete a[e],a}),x(s=>s.map(s=>{let a={...s};return delete a[e],a}))},V=(0,n.useRef)(!0);(0,n.useEffect)(()=>{if(V.current){V.current=!1;return}let e=setTimeout(()=>{console.log("Sauvegarde automatique des donn\xe9es...",m)},1e3);return()=>clearTimeout(e)},[m]);let $=m.find(e=>e.week===A);return(0,l.jsxs)(t.Zp,{children:[(0,l.jsxs)(t.aR,{className:"no-print",children:[(0,l.jsx)(t.ZB,{children:"Organisation Hebdomadaire des Affectations de Service"}),(0,l.jsx)(t.BT,{children:"Planifiez et visualisez les affectations de service pour chaque semaine."})]}),(0,l.jsxs)(t.Wu,{children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6 p-4 border rounded-lg bg-muted/40 no-print",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(u.Label,{htmlFor:"week-select",className:"sr-only",children:"Semaine"}),(0,l.jsxs)(i.l6,{value:A,onValueChange:k,children:[(0,l.jsx)(i.bq,{id:"week-select",className:"w-[200px]",children:(0,l.jsx)(i.yv,{placeholder:"S\xe9lectionner une semaine"})}),(0,l.jsx)(i.gC,{children:m.map(e=>(0,l.jsx)(i.eb,{value:e.week,children:e.week},e.week))})]}),(0,l.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,l.jsx)(p.A,{className:"h-4 w-4"})}),(0,l.jsxs)(h.AM,{children:[(0,l.jsx)(h.Wv,{asChild:!0,children:(0,l.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,l.jsx)(f.A,{className:"h-4 w-4"})})}),(0,l.jsx)(h.hl,{className:"w-auto p-0",onInteractOutside:e=>{e.preventDefault()},children:(0,l.jsx)(j.V,{mode:"single",selected:M,onSelect:e=>{let s;if(!e)return;C(e);let a=(0,E.k)(e,{locale:P.fr}),l=(0,S.$)(e,{locale:P.fr}),n=(0,y.GP)(a,"MMMM",{locale:P.fr}),t=(0,y.GP)(l,"MMMM",{locale:P.fr}),r=(0,y.GP)(a,"dd",{locale:P.fr}),i=(0,y.GP)(l,"dd",{locale:P.fr});k(n===t?"".concat(n," ").concat(r,"–").concat(i):"".concat(n," ").concat(r,"–").concat(t," ").concat(i))},initialFocus:!0})})]}),(0,l.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,l.jsx)(g.A,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(O,{onAddService:(e,l)=>{let n=e.replace(/ /g,"_");if(s.includes(n))return void alert("Ce service existe d\xe9j\xe0.");a(e=>[...e,n]),d(e=>({...e,[n]:l})),x(e=>e.map(e=>({...e,[n]:[]})))}}),(0,l.jsxs)(c.Button,{variant:"outline",onClick:()=>{x(e=>e.map(e=>{if(e.week===A){let a={...e};return s.forEach(e=>{a[e]=[]}),a}return e}))},children:[(0,l.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Effacer"]}),(0,l.jsx)(H,{rolePersonCounts:o}),(0,l.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>{window.print()},children:(0,l.jsx)(N.A,{className:"h-4 w-4"})}),(0,l.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,l.jsx)(b.A,{className:"h-4 w-4"})})]})]}),(0,l.jsxs)("div",{className:"mb-8 no-print",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4 text-red-500 text-center",children:A}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:s.map(s=>{let a,n="Entretien"===s,t=(null==$?void 0:$[s])||[];return a=n?D.filter(e=>t.includes(e.name)).map(e=>e.id):e.filter(e=>t.includes(e.displayName)).map(e=>e.id),(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(u.Label,{children:s.replace(/_/g," ")}),(0,l.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>R(s),children:(0,l.jsx)(w.A,{className:"h-4 w-4"})})]}),(0,l.jsx)(B.K,{options:n?T:_,selected:a,onChange:e=>I(s,e),placeholder:"S\xe9lectionner..."})]},s)})})]}),(0,l.jsxs)("div",{className:"overflow-x-auto printable-area",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-4 text-center print-only hidden",children:"Programme des services - Semaine du ".concat(A)}),(0,l.jsxs)(r.XI,{children:[(0,l.jsx)(r.A0,{children:(0,l.jsxs)(r.Hj,{children:[(0,l.jsx)(r.nd,{className:"w-[180px]",children:"Date"}),s.map(e=>(0,l.jsx)(r.nd,{children:e.replace(/_/g," ")},e))]})}),(0,l.jsx)(r.BF,{children:m.map(e=>(0,l.jsxs)(r.Hj,{className:e.week===q()?"bg-yellow-100/70":"",children:[(0,l.jsx)(r.nA,{className:"font-medium",children:e.week}),s.map(s=>(0,l.jsx)(r.nA,{children:(0,l.jsx)("div",{className:"flex flex-col gap-1",children:(e[s]||[]).map((e,s)=>(0,l.jsx)("span",{className:"h-6",children:e},s))})},s))]},e.week))})]})]})]})]})}function O(e){let{onAddService:s}=e,[a,t]=(0,n.useState)(!1),[r,i]=(0,n.useState)(""),[d,x]=(0,n.useState)(1);return(0,l.jsxs)(o.lG,{open:a,onOpenChange:t,children:[(0,l.jsx)(o.zM,{asChild:!0,children:(0,l.jsxs)(c.Button,{variant:"outline",children:[(0,l.jsx)(M.A,{className:"mr-2 h-4 w-4"}),"Ajouter un service"]})}),(0,l.jsxs)(o.Cf,{className:"sm:max-w-[425px]",children:[(0,l.jsx)(o.c7,{children:(0,l.jsx)(o.L3,{children:"Ajouter un nouveau service"})}),(0,l.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(u.Label,{htmlFor:"role-name",className:"text-right",children:"Nom"}),(0,l.jsx)(m.p,{id:"role-name",value:r,onChange:e=>i(e.target.value),className:"col-span-3",placeholder:"Ex: Entretien"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(u.Label,{htmlFor:"person-count",className:"text-right",children:"Personnes"}),(0,l.jsx)(m.p,{id:"person-count",type:"number",value:d,onChange:e=>x(parseInt(e.target.value,10)||1),className:"col-span-3",min:"1"})]})]}),(0,l.jsx)(o.Es,{children:(0,l.jsx)(c.Button,{onClick:()=>{r.trim()&&(s(r.trim(),d),i(""),x(1),t(!1))},children:"Ajouter le service"})})]})]})}function H(e){let{rolePersonCounts:s}=e,[a,t]=(0,n.useState)(!1);return(0,l.jsxs)(o.lG,{open:a,onOpenChange:t,children:[(0,l.jsx)(o.zM,{asChild:!0,children:(0,l.jsxs)(c.Button,{variant:"outline",children:[(0,l.jsx)(C.A,{className:"mr-2 h-4 w-4"}),"Saisie automatique"]})}),(0,l.jsxs)(o.Cf,{className:"sm:max-w-[600px]",children:[(0,l.jsx)(o.c7,{children:(0,l.jsx)(o.L3,{children:"Param\xe8tres de la saisie automatique"})}),(0,l.jsxs)("div",{className:"grid gap-6 py-4 max-h-[60vh] overflow-y-auto pr-4",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(u.Label,{className:"font-semibold",children:"Choisir les r\xf4les et le nombre de personnes"}),Object.entries(s).map(e=>{let[s,a]=e;return(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(u.Label,{htmlFor:s,className:"flex-1",children:s.replace(/_/g," ")}),(0,l.jsx)("div",{className:"flex items-center gap-4",children:[...Array(a)].map((e,a)=>(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)(d.S,{id:"".concat(s,"-").concat(a+1)}),(0,l.jsx)(u.Label,{htmlFor:"".concat(s,"-").concat(a+1),className:"text-sm font-normal",children:a+1})]},a))})]},s)})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(u.Label,{htmlFor:"weeks-count",children:"Semaines pour l'attribution"}),(0,l.jsxs)(i.l6,{children:[(0,l.jsx)(i.bq,{id:"weeks-count",children:(0,l.jsx)(i.yv,{placeholder:"Nombre de semaines"})}),(0,l.jsx)(i.gC,{children:[2,3,4,5,6,7,8].map(e=>(0,l.jsxs)(i.eb,{value:String(e),children:[e," semaines"]},e))})]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(u.Label,{htmlFor:"attribution-criteria",children:"Command\xe9 par"}),(0,l.jsxs)(i.l6,{children:[(0,l.jsx)(i.bq,{id:"attribution-criteria",children:(0,l.jsx)(i.yv,{placeholder:"Crit\xe8re d'attribution"})}),(0,l.jsxs)(i.gC,{children:[(0,l.jsx)(i.eb,{value:"recent",children:"Service r\xe9cent"}),(0,l.jsx)(i.eb,{value:"rotation",children:"Rotation"}),(0,l.jsx)(i.eb,{value:"random",children:"Al\xe9atoire"})]})]})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,l.jsx)(d.S,{id:"check-existing",defaultChecked:!0}),(0,l.jsx)(u.Label,{htmlFor:"check-existing",className:"font-normal",children:"V\xe9rifier l’attribution existante"})]}),(0,l.jsxs)(x.Fc,{variant:"destructive",className:"mt-4",children:[(0,l.jsx)(A.A,{className:"h-4 w-4"}),(0,l.jsx)(x.TN,{children:"Cette action va \xe9craser toutes les futures affectations pour les r\xf4les et semaines s\xe9lectionn\xe9s."})]})]}),(0,l.jsxs)(o.Es,{children:[(0,l.jsx)(o.HM,{asChild:!0,children:(0,l.jsx)(c.Button,{type:"button",variant:"secondary",children:"❌ Annuler"})}),(0,l.jsx)(c.Button,{type:"button",onClick:()=>{console.log("Lancement de la saisie automatique..."),t(!1),alert("Saisie automatique effectu\xe9e (simulation) !")},children:"\uD83D\uDFE6 Saisie automatique"})]})]})]})}},50824:(e,s,a)=>{Promise.resolve().then(a.bind(a,44970))}},e=>{var s=s=>e(e.s=s);e.O(0,[4277,9456,2925,1720,5988,3957,2985,7344,7689,1678,4860,8441,1684,7358],()=>s(50824)),_N_E=e.O()}]);